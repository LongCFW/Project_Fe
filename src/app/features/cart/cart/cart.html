<main class="container my-5 cart-page">
  <div class="wrap" id="long">
    <!-- üîπ Ti√™u ƒë·ªÅ trang gi·ªè h√†ng -->
    <h3 class="mb-4 text-center fw-semibold">Gi·ªè h√†ng c·ªßa b·∫°n</h3>

    <!-- üî∏ Tr∆∞·ªùng h·ª£p gi·ªè h√†ng tr·ªëng -->
    <div *ngIf="cart.length === 0" class="empty-cart text-center py-5">
      <p class="text-muted fs-5">Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng</p>
      <a [routerLink]="['/products']" class="btn btn-outline-primary mt-3">
        üõç Mua s·∫Øm ngay
      </a>
    </div>

    <!-- üî∏ Tr∆∞·ªùng h·ª£p c√≥ s·∫£n ph·∫©m trong gi·ªè -->
    <div *ngIf="cart.length > 0">
      <!-- üîπ Danh s√°ch s·∫£n ph·∫©m -->
      <ul id="cartList" class="list-group mb-4 shadow-sm">
        <li *ngFor="let item of cart"
          class="list-group-item cart-item d-flex align-items-center justify-content-between flex-wrap">
          <!-- üî∏ Th√¥ng tin s·∫£n ph·∫©m -->
          <div class="d-flex align-items-center flex-wrap gap-3">
            <img [src]="item.img" alt="{{ item.name }}" class="cart-img" />
            <div>
              <h6 class="mb-1">{{ item.name }}</h6>
              <small class="text-muted">Gi√°: {{ item.gia | number }} VND</small><br />

              <!-- üî∏ ƒêi·ªÅu ch·ªânh s·ªë l∆∞·ª£ng -->
              <div class="d-flex align-items-center mt-1 gap-2">
                <button type="button" class="btn btn-sm btn-outline-secondary" (click)="decreaseQty(item)"
                  aria-label="Gi·∫£m s·ªë l∆∞·ª£ng s·∫£n ph·∫©m {{ item.name }}">
                  ‚àí
                </button>
                <span class="fw-semibold">{{ item.quantity }}</span>
                <button type="button" class="btn btn-sm btn-outline-secondary" (click)="increaseQty(item)"
                  aria-label="TƒÉng s·ªë l∆∞·ª£ng s·∫£n ph·∫©m {{ item.name }}">
                  +
                </button>
              </div>
            </div>
          </div>

          <!-- üî∏ X√≥a s·∫£n ph·∫©m -->
          <button type="button" class="btn btn-outline-danger btn-sm" (click)="removeItem(item)"
            aria-label="X√≥a s·∫£n ph·∫©m {{ item.name }} kh·ªèi gi·ªè h√†ng">
            X√≥a
          </button>
        </li>
      </ul>

      <!-- üîπ T·ªïng c·ªông -->
      <div class="cart-summary text-end mb-3">
        <h5>T·ªïng c·ªông: <span class="fw-bold">{{ total | number }}</span> VND</h5>
      </div>

      <!-- üîπ N√∫t h√†nh ƒë·ªông -->
      <div class="d-flex justify-content-end align-items-center gap-3 flex-wrap">
        <button type="button" class="btn btn-outline-danger px-4" (click)="clearCart()">üóë X√≥a t·∫•t c·∫£</button>
        <button type="button" class="btn btn-success px-4" (click)="checkout()">üí≥ Thanh to√°n</button>
      </div>

      <!-- üîπ Form thanh to√°n -->
      <div *ngIf="showCheckout" class="mt-5 p-4 shadow-sm rounded bg-light checkout-form">
        <h4 class="mb-3">Th√¥ng tin thanh to√°n</h4>

        <form (ngSubmit)="submitCheckout()" #checkoutForm="ngForm" novalidate>
          <!-- üî∏ N·∫øu ch∆∞a ƒëƒÉng nh·∫≠p -->
          <div *ngIf="!currentUser">
            <!-- H·ªç v√† t√™n -->
            <div class="mb-3">
              <label for="fullname" class="form-label">H·ªç v√† t√™n</label>
              <input type="text" id="fullname" class="form-control" name="fullname" [(ngModel)]="formData.fullname"
                required pattern="^[A-Za-z√Ä-·ªπ\\s]+$" placeholder="Nh·∫≠p h·ªç v√† t√™n" aria-label="H·ªç v√† t√™n"
                title="H·ªç v√† t√™n" />
              <div *ngIf="checkoutForm.submitted && checkoutForm.controls['fullname']?.invalid"
                class="text-danger small mt-1">
                H·ªç t√™n kh√¥ng h·ª£p l·ªá.
              </div>
            </div>

            <!-- Email -->
            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" id="email" class="form-control" name="email" [(ngModel)]="formData.email" required
                placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ email" aria-label="ƒê·ªãa ch·ªâ email" title="ƒê·ªãa ch·ªâ email" />
              <div *ngIf="checkoutForm.submitted && checkoutForm.controls['email']?.invalid"
                class="text-danger small mt-1">
                Email kh√¥ng h·ª£p l·ªá.
              </div>
            </div>
          </div>

          <!-- üî∏ C√°c tr∆∞·ªùng lu√¥n hi·ªÉn th·ªã -->
          <div class="mb-3">
            <label for="phone" class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
            <input type="tel" id="phone" class="form-control" name="phone" [(ngModel)]="formData.phone" required
              pattern="^(0[0-9]{9})$" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" aria-label="S·ªë ƒëi·ªán tho·∫°i"
              title="S·ªë ƒëi·ªán tho·∫°i" />
            <div *ngIf="checkoutForm.submitted && checkoutForm.controls['phone']?.invalid"
              class="text-danger small mt-1">
              S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá.
            </div>
          </div>

          <div class="mb-3">
            <label for="payment" class="form-label">Ph∆∞∆°ng th·ª©c thanh to√°n</label>
            <select id="payment" class="form-select" name="payment" [(ngModel)]="formData.payment" required
              aria-label="Ph∆∞∆°ng th·ª©c thanh to√°n" title="Ph∆∞∆°ng th·ª©c thanh to√°n">
              <option value="">-- Ch·ªçn --</option>
              <option value="cod">Thanh to√°n khi nh·∫≠n h√†ng (COD)</option>
              <option value="bank">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</option>
              <option value="momo">V√≠ MoMo</option>
              <option value="zalo">ZaloPay</option>
            </select>
            <div *ngIf="checkoutForm.submitted && checkoutForm.controls['payment']?.invalid"
              class="text-danger small mt-1">
              Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n.
            </div>
          </div>

          <div class="mb-3">
            <label for="address" class="form-label">ƒê·ªãa ch·ªâ giao h√†ng</label>
            <textarea id="address" class="form-control" name="address" rows="2" [(ngModel)]="formData.address" required
              aria-label="ƒê·ªãa ch·ªâ giao h√†ng" title="ƒê·ªãa ch·ªâ giao h√†ng"
              placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ nh·∫≠n h√†ng c·ªßa b·∫°n"></textarea>
            <div *ngIf="checkoutForm.submitted && checkoutForm.controls['address']?.invalid"
              class="text-danger small mt-1">
              Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ giao h√†ng.
            </div>
          </div>

          <!-- üîπ N√∫t x√°c nh·∫≠n -->
          <div class="text-end mt-4">
            <button type="submit" class="btn btn-primary px-5">X√°c nh·∫≠n thanh to√°n</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</main>